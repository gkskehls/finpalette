# Finpalette 프로젝트 개발 계획서

## 1. 프로젝트 목표 (Mission)

- **핵심 목표:** 사용자가 자신의 수입과 지출을 '팔레트의 색을 고르듯' 쉽고 직관적으로 분류하고, 한눈에 파악할 수 있는 가계부 웹앱을 제공한다.
- **차별점:**
  - **직관적인 카테고리화:** 'Palette' 컨셉을 살려 사용자가 직접 카테고리별 색상을 지정하고 시각적으로 지출 내역을 인지할 수 있도록 한다.
  - **단순함:** 복잡한 재무 분석보다는, 매일의 소비를 기록하고 월별 흐름을 파악하는 데 집중한다.
  - **모바일 중심 경험:** 스마트폰에서 언제 어디서든 쉽고 빠르게 내역을 기록하고 확인할 수 있는 모바일 우선(Mobile-First) 인터페이스를 제공한다.

  ***

## 2. 기술 스택 및 아키텍처

- **Frontend:** **React (with Vite)**
  - 역할: 사용자 인터페이스(UI) 전체를 구축합니다.
  - **상태 관리**: **TanStack Query(React Query)** 를 사용하여 서버 상태(API 데이터)를 관리합니다.
  - **차트 라이브러리**: **Recharts** 를 사용하여 데이터 시각화 기능을 구현합니다.
  - **아이콘 시스템**: 모든 아이콘은 SVG를 기반으로 사용하여 확장성과 스타일 일관성을 확보합니다.
- **Database:** **Supabase**
  - 역할: 모든 사용자 데이터(가계부 내역, 카테고리 등)를 저장하고 관리합니다.
- **Auth:** **Supabase**
  - 역할: 사용자 인증(Google OAuth)을 처리합니다.
- **Hosting & CI/CD:** **Firebase Hosting & GitHub Actions**
  - 역할: 개발된 웹앱을 배포하고, GitHub과 연동하여 자동 배포 파이프라인을 구축합니다.
- **IDE:** **IntelliJ**
- **Version Control:** **GitHub**

  ***

## 3. 데이터베이스 및 데이터 구조 설계

> **v2 설계 (공유 기능 포함)**: 모든 데이터는 `user_id`가 아닌 `palette_id`에 종속됩니다.

### 3.1. 데이터 ID 관리 전략

- **`id` (서버 ID)**: `uuid` 타입. 데이터베이스에 저장된 데이터의 고유 식별자입니다. 로컬에서 새로 생성된 데이터는 이 값을 `null`로 가집니다. 서버 동기화 여부를 판별하는 기준으로 사용됩니다.
- **`localId` (클라이언트 ID)**: `string` 타입. 로컬에서 데이터 생성 시 `uuid` 라이브러리로 즉시 부여하는 임시 ID입니다. React의 `key` 값으로 사용되며, 서버에는 저장되지 않습니다.

### 3.2. 데이터 코드 시스템

- 핵심 데이터(`type`, `category` 등)는 `inc`, `c01`과 같이 사전에 정의된 **고유 코드(최대 3자리)**를 사용하여 DB에 저장합니다.
- 코드와 실제 표시될 이름(예: "수입", "식비")의 매핑 정보는 프론트엔드 프로젝트 내의 `constants.ts` 파일에서 중앙 관리합니다.

### 3.3. `palettes` (공유 공간) 테이블

| 컬럼명     | 타입   | 설명                                    |
| ---------- | ------ | --------------------------------------- |
| `id`       | `uuid` | 팔레트 고유 식별자 (PK)                 |
| `name`     | `text` | 팔레트 이름 (예: "우리 가족 가계부")    |
| `owner_id` | `uuid` | 팔레트 소유자 ID (`auth.users.id` 참조) |

### 3.4. `palette_members` (팔레트 멤버) 테이블

| 컬럼명       | 타입   | 설명                                 |
| ------------ | ------ | ------------------------------------ |
| `palette_id` | `uuid` | 팔레트 ID (FK, `palettes.id` 참조)   |
| `user_id`    | `uuid` | 사용자 ID (FK, `auth.users.id` 참조) |
| `role`       | `text` | 역할 (예: 'owner', 'member')         |

### 3.5. `transactions` (거래 내역) 테이블

| 컬럼명          | 타입          | 설명                              | 비고                   |
| --------------- | ------------- | --------------------------------- | ---------------------- |
| `id`            | `uuid`        | 고유 식별자 (Primary Key)         | `uuid_generate_v4()`   |
| `palette_id`    | `uuid`        | 팔레트 ID (Foreign Key)           | `palettes.id` 참조     |
| `created_at`    | `timestamptz` | 생성 시각                         | `now()`                |
| `date`          | `date`        | 실제 거래 날짜                    |                        |
| `type`          | `text`        | 거래 타입 코드 (예: 'inc', 'exp') |                        |
| `amount`        | `integer`     | 금액                              |                        |
| `category_code` | `text`        | 카테고리 코드 (Foreign Key)       | `categories.code` 참조 |
| `description`   | `text`        | 거래 내용 메모                    |                        |

### 3.6. `categories` (카테고리) 테이블

| 컬럼명       | 타입   | 설명                       | 비고               |
| ------------ | ------ | -------------------------- | ------------------ |
| `code`       | `text` | 카테고리 고유 코드 (PK)    | 예: 'c01', 'c02'   |
| `palette_id` | `uuid` | 팔레트 ID (Foreign Key)    | `palettes.id` 참조 |
| `name`       | `text` | 카테고리 이름 (예: "식비") |                    |
| `color`      | `text` | 카테고리 대표 색상         | 예: `#FFD700`      |
| `icon`       | `text` | `lucide-react` 아이콘 이름 | 예: 'Utensils'     |

> **⚠️ 중요:** 모든 테이블에 **Row Level Security (RLS)**를 활성화하여, 사용자는 자신의 데이터만 접근할 수 있도록 정책을 설정해야 합니다.

---

## 4. 개발 로드맵 (단계별 기능 구현)

### Phase 1: MVP (Minimum Viable Product) - 로컬 기능 강화

- **목표:** 로그인 없이 사용하는 게스트 모드의 완성도를 높여, 실제 사용 가능한 수준의 핵심 기능을 제공한다.
- **세부 작업:**
  1. **[O] 로컬 스토리지 기반 데이터 관리 기능 구현 (Guest Mode)**
  2. **[O] 기본 레이아웃 구현 (헤더, 하단 네비, FAB)**
  3. **[O] 대시보드 페이지 기본 구현**
  4. **[O] 빠른 내역 추가 기능 (기본 폼)**
  5. **[O] 카테고리 시스템 확장**
  6. **[O] 동적 아이콘 표시 기능**
  7. **[O] 내역 입력 폼 개선**
  8. **[O] 대시보드 데이터 연동 강화**

### Phase 2: 고도화 - 시각화 및 동기화

- **목표:** 데이터 시각화 기능을 도입하고, 온라인 동기화의 기반을 마련한다.
- **세부 작업:**
  1. **[O] 데이터 시각화 기능 구현**
  2. **[O] 거래 내역 관리 페이지 구현**
  3. **[O] 게스트 저장 공간 현황 UI 구현**
  4. **[O] 선택적 회원가입 및 데이터 동기화**
  5. **[X] 사용자 정의 카테고리**

### Phase 3: 확장 - 편의 기능 추가

- **목표:** 사용자를 위한 편의 기능 추가 및 완성도 향상
- **세부 작업:**
  1. **[진행중] 공유 가계부(팔레트) 기능**:
     - **[O] DB 스키마 설계 및 마이그레이션 SQL 작성**
     - **[O] 팔레트 전환 UI 및 데이터 연동 (조회/수정/삭제)**
     - **[O] 시크릿 메모 기능 구현 (입력/조회)**
     - **[O] 팔레트 생성 기능**
       - [O] `create_palette` RPC 함수 작성 (DB 트랜잭션 보장)
       - [O] `useAddPaletteMutation` 훅 구현
       - [O] `PaletteFormModal` UI 구현 및 연동
     - **[O] 멤버 초대 및 관리 기능**
       - [O] `accept_invitation` RPC 함수 설계 및 구현
       - [O] 초대 링크 생성 및 공유 UI 구현
       - [O] 초대 수락 페이지 및 로직 구현
       - [O] 멤버 목록 조회 UI 구현 (프로필 연동)
       - [O] 멤버 관리(추방/권한변경) 기능 구현
       - [O] 팔레트 설정 모달 개편 (멤버/설정 탭 분리, 이름/색상 수정, 삭제 안전장치)
  2. **[O] UI/UX 개선**
     - **[O] 전체 내역 리스트 스타일 개선 (카드형, 말줄임표 처리)**
     - **[O] 모달/팝업 배경 투명 문제 해결 (CSS 변수 매핑)**
     - **[O] 모바일 입력창 줌인 방지 및 버튼 레이아웃 수정**
     - **[O] 하단 네비게이션/FAB에 의한 콘텐츠 가림 현상 해결 (하단 여백 추가)**
     - **[O] 내역 입력 폼 UX 개선 (날짜 너비 조정, 카테고리 자동 선택)**
     - **[O] 프로필 관리 개선 (이미지 업로드, 리사이징, 이름 수정)**
  3. **[X] 내용/카테고리 기반 거래 내역 검색 기능**
  4. **[X] 반복 내역(고정 지출/수입) 자동 등록 기능**
  5. **[X] PWA(Progressive Web App) 적용 및 아이콘 설정**
  6. **[X] 데스크탑 화면 최적화**

### Phase 4: 오픈 전 완성도 높이기 (Polishing) - [현재 우선순위]

- **목표:** 앱의 사용성을 저해하는 요소를 제거하고, 시각적 완성도와 반응성을 높여 '출시 가능한 수준'으로 만든다.
- **세부 작업:**
  1.  **[O] 거래 내역 리스트 UI 전면 개편 (Compact Design)**
      - [O] 한 화면에 더 많은 정보가 보이도록 여백 및 폰트 크기 최적화
      - [O] 날짜별 그룹화 및 Sticky Header 적용
  2.  **[O] 무한 스크롤 (Infinite Scroll) 구현**
      - [O] 대량의 데이터 로딩 시 성능 저하 방지
      - [O] 스크롤 하단 도달 시 추가 데이터 로딩 (Pagination)
  3.  **[O] 텅 빈 화면 (Empty State) 디자인 적용**
      - [O] 데이터가 없을 때(내역 없음, 멤버 없음 등) 사용자에게 안내 문구와 일러스트 제공
  4.  **[O] 토스트 알림 (Toast Notification) 시스템 도입**
      - `alert()` 대신 부드러운 팝업으로 성공/실패 메시지 전달
      - `react-hot-toast` 라이브러리 적용 완료
  5.  **[ ] 로딩 스켈레톤 (Skeleton UI) 적용**
      - 데이터 로딩 중 깜빡임 방지 및 체감 속도 향상
  6.  **[ ] 모바일 터치 피드백 및 애니메이션 강화**
      - 버튼 클릭 시 `active` 효과, 페이지 전환 애니메이션 등

---

## 5. 데이터베이스 연결 및 인증 상세 계획

### 5.1. 인증 (Authentication)

- **현재 방식:** 구글 로그인 (Google OAuth)만 허용 중.
- **세션 관리:** Supabase의 JWT 기반 세션 관리를 활용합니다.
- **사용자 프로필:** `auth.users` 테이블 외에 추가 사용자 정보(닉네임 등)를 위한 `profiles` 테이블 필요 여부 및 연결 방안을 논의합니다.

### 5.2. Supabase 클라이언트 초기화 및 환경 변수 관리

- **클라이언트 초기화 파일 위치:** `src/lib/supabase.ts`
- **환경 변수 관리:** `.env.local` 파일에 `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY` 형태로 저장합니다.
- **클라이언트 객체 내보내기:** 초기화된 Supabase 클라이언트 객체는 다른 파일에서 쉽게 가져다 쓸 수 있도록 `export` 합니다.

### 5.3. 인증 방식 확장 검토 (Future Authentication Options)

추후 로그인 방식을 확장할 때 참고하기 위한 기술 분석 및 장단점 정리입니다.

#### A. 소셜 로그인 확장

1. **카카오 (Kakao)**
   - **상태:** Supabase 공식 지원.
   - **난이도:** 중 (카카오 개발자 센터 설정 필요).
   - **장점:** 한국 사용자 접근성 최상.
   - **제약:** `REST API 키` 발급 및 `Redirect URL` 설정이 선행되어야 함.

2. **애플 (Apple)**
   - **상태:** Supabase 공식 지원.
   - **난이도:** 상 (설정 복잡).
   - **제약:** **Apple Developer Program($99/년)** 가입 필수. iOS 앱 출시 시 필수 사항이나, 웹앱 단계에서는 비용 부담이 있음.

3. **네이버 (Naver)**
   - **상태:** **Supabase 미지원**.
   - **난이도:** 최상.
   - **이유:** Supabase Auth에서 네이버를 지원하지 않아, Edge Function을 이용한 커스텀 인증 로직을 직접 구현해야 함. 유지보수 비용 높음.

#### B. 이메일 매직 링크 (Magic Link)

- **개념:** 사용자가 이메일을 입력하면, 해당 메일로 '로그인 링크'가 전송됩니다. 링크를 클릭하면 비밀번호 없이 즉시 로그인됩니다.
- **상태:** Supabase 기본 지원 (설정 불필요).
- **장점:**
  - 비밀번호를 기억할 필요가 없어 보안에 강력함.
  - 특정 소셜 계정이 없는 사용자도 모두 수용 가능.
  - 구현이 매우 간단함.
- **단점:**
  - 로그인할 때마다 메일함을 열어야 하는 번거로움 (앱 이탈 발생).
  - 메일 발송 딜레이가 발생할 수 있음.

---

## 6. 알려진 이슈 (Known Issues)

- **비로그인(게스트) 상태에서 내역 수정 오류:** 게스트 모드에서 내역을 수정하려고 할 때 오류가 발생하거나 수정 사항이 반영되지 않는 문제가 보고됨. (추후 로컬 스토리지 로직 점검 필요)
- **비공개 메모(Private Memo) 권한:** `private_memo`는 내역을 최초 등록한 `user_id`를 기준으로만 조회가 가능. 다른 사용자가 `private_memo`를 추가/수정하더라도 원본 등록자 외에는 볼 수 없는 문제가 있음.
