# Finpalette 앱 기능 명세서

이 문서는 Finpalette 프로젝트의 주요 기능, 사용자 흐름, 화면 구성을 구체적으로 정의합니다. `PROJECT_PLAN.md`의 상위 목표를 실제 구현 가능한 설계로 구체화하는 것을 목표로 합니다.

---

## 1. 핵심 사용자 흐름 (Core User Flow)

사용자가 앱을 사용하는 대표적인 시나리오입니다.

1.  **[O] 첫 방문 및 게스트 사용 (Guest Onboarding):**
    - **흐름:** `앱 첫 방문` → `별도 절차 없이 즉시 대시보드 사용 시작`
    - **설명:** 로그인/회원가입 과정 없이 바로 가계부 기능 사용을 시작합니다. 모든 데이터는 브라우저의 로컬 스토리지에 저장됩니다.

2.  **[O] 계정 연동 및 데이터 동기화 (Account Sync):**
    - **목표:** 여러 기기에서 게스트 모드로 사용하던 데이터를 하나의 계정으로 안전하게 통합합니다.
    - **핵심 로직:**
      1.  **로그인 시도:** 사용자가 게스트로 사용하던 기기에서 로그인을 시도합니다.
      2.  **로컬 데이터 스캔:** 로그인 성공 직후, 앱은 로컬 스토리지에 저장된 데이터(`transactions`, `categories`)를 스캔합니다.
      3.  **신규 데이터 업로드:** 로컬 데이터 중 서버 ID(`id`)가 없는 항목들을 Supabase 서버에 새로 생성(INSERT)합니다.
      4.  **ID 업데이트:** 서버로부터 생성된 데이터의 고유 ID(uuid)를 응답받아, 로컬 스토리지의 해당 항목에 ID를 업데이트하여 '동기화 완료' 상태로 만듭니다.
      5.  **서버 데이터 다운로드:** 서버에 저장된 모든 데이터를 기기로 가져옵니다.
      6.  **데이터 병합(Merge):** 기기로 가져온 서버 데이터와 로컬 스토리지의 데이터를 합칩니다. 이 시점부터 해당 기기는 서버 데이터를 기준으로 동작합니다.

3.  **일상적인 내역 기록 (Daily Logging):**
    - **흐름:** `어느 화면에서든` → `플로팅 액션 버튼(+) 클릭` → `내역 입력 모달(Modal) 열림` → `정보 입력 후 저장` → `모달 닫힘` → `대시보드에 즉시 반영`
    - **설명:** 페이지 이동 없이 현재 화면 위에 모달을 띄워 사용자의 작업 흐름을 방해하지 않고 빠르게 내역을 기록합니다.

4.  **소비 현황 파악 (Reviewing):**
    - **흐름:** `대시보드 접속` → `월별 요약 확인` → `카테고리별 지출 확인` → `최근 거래 내역 스크롤`
    - **설명:** 앱 실행 시 가장 먼저 마주하는 대시보드에서 별도 조작 없이 현재 재정 상태를 파악합니다.

5.  **심층 분석 및 관리 (Analysis & Management):**
    - **흐름:** `하단 네비게이션` → `'통계' 또는 '마이' 탭 클릭` → `해당 페이지로 이동`
    - **설명:** 상세 분석이나 설정과 같은 부가 기능은 명확히 구분된 페이지에서 제공합니다.

---

## 2. 화면 구성 및 레이아웃 (Screen Composition & Layout)

### 2.1. 공통 레이아웃

- **헤더 (Header):** 페이지 상단에 위치하며, 현재 페이지의 제목과 알림 아이콘 등을 표시합니다.
- **콘텐츠 영역 (Main Content):** 각 페이지의 핵심 내용이 표시되는 공간입니다.
- **하단 네비게이션 (Bottom Navigation):** 앱의 핵심 기능(`대시보드`, `통계`, `마이`) 간 빠른 **페이지 이동**을 담당합니다.
- **플로팅 액션 버튼 (FAB):** 내역 추가 기능을 위해 화면 우하단에 항상 떠 있는 `+` 버튼입니다.

### 2.2. 페이지별 상세 기능

#### A. 대시보드 페이지 (`DashboardPage`)

- **역할:** 앱의 메인 화면. 현재 재정 상태를 한눈에 요약하여 보여줍니다.
- **세부 기능:**
  1.  **월별 요약 카드:** 현재 월의 총수입, 총지출, 합계 표시. 이전/다음 달 데이터 전환 기능.
  2.  **카테고리별 지출 목록:** 이번 달 지출액이 높은 순서대로 카테고리 목록 나열.
  3.  **최근 거래 내역:** '오늘', '어제', '날짜' 순으로 그룹화된 최신 거래 내역 목록.

#### B. 내역 입력 모달 (Transaction Form Modal)

- **역할:** 수입/지출 내역을 가장 빠르고 간편하게 입력하는 인터페이스.
- **세부 기능:**
  1.  수입/지출 선택 탭
  2.  금액 입력 필드
  3.  카테고리 선택
  4.  날짜 선택
  5.  메모 입력 필드
  6.  저장/취소 버튼

#### C. 통계 페이지 (`StatsPage`)

- **역할:** 데이터를 시각화하여 사용자의 소비 습관 분석을 돕습니다.
- **세부 기능:**
  1.  기간 선택 필터 (월별/주별)
  2.  카테고리별 지출 원형 차트
  3.  기간별 수입/지출 막대그래프

#### D. 마이페이지 (`ProfilePage`)

- **역할:** 계정 정보(이름 수정 등), 카테고리 등 앱의 전반적인 설정을 관리합니다.
- **세부 기능:**
  1.  **프로필 정보 관리 (이름 수정) 및 로그아웃**
  2.  **[O] 게스트 저장 공간 관리 (게스트 전용)**
  3.  **카테고리 관리 메뉴**
  4.  **기타 설정 메뉴**

#### E. 팔레트 관리 기능 (`ProfilePage` 내) - Phase 3

- **역할:** 공유 가계부를 생성하고 멤버를 관리합니다.
- **세부 기능:**
  1.  **팔레트 전환 UI:** 현재 활성화된 팔레트를 보여주고, 다른 팔레트로 전환하는 기능 (헤더 영역).
  2.  **팔레트 관리 메뉴:** 팔레트 생성, 멤버 초대/관리, 팔레트 나가기 등의 기능 제공.

#### F. 공유 가계부 (Multi-Palette) 기능 명세 (Phase 3)

'공유 가계부'는 Finpalette의 핵심 기능으로, 사용자가 목적에 따라 여러 개의 가계부(팔레트)를 생성하고 멤버를 초대하여 함께 관리하는 기능입니다.

##### 1. 핵심 컨셉: "상황에 맞는 팔레트"

- **모든 가계부는 '팔레트'**: 기존의 개인 가계부도 '나의 팔레트'라는 기본 팔레트로 취급하여, 모든 가계부 관리 경험을 일원화합니다.
- **팔레트 전환**: 사용자는 자신이 속한 여러 팔레트(개인, 가족, 연인, 모임 등) 목록 중 하나를 선택하여 해당 가계부의 내역과 통계를 확인합니다.

##### 2. UI/UX 및 사용자 흐름

- **팔레트 전환 (Switching):**
  - **위치:** 앱 최상단 헤더 중앙에 현재 활성화된 팔레트의 이름(예: "우리 가족 🎨")을 표시합니다.
  - **동작:** 팔레트 이름을 클릭하면, 사용자가 속한 모든 팔레트 목록이 담긴 **바텀 시트(Bottom Sheet)**가 나타납니다.
  - **전환:** 목록에서 다른 팔레트를 선택하면 즉시 해당 팔레트의 데이터로 앱 전체가 리프레시됩니다.

- **팔레트 생성 (Creation):**
  - 팔레트 목록 바텀 시트 하단에 위치한 `[+ 새 팔레트 만들기]` 버튼을 통해 새로운 팔레트를 생성합니다.
  - 생성 시 '팔레트 이름'과 '테마 색상'을 지정할 수 있습니다.

- **멤버 초대 (Invitation):**
  - 각 팔레트의 설정 화면에서 `[+ 멤버 초대하기]` 버튼을 클릭합니다.
  - **초대 링크 공유 방식**을 사용합니다. 생성된 고유 링크를 복사하여 카카오톡, 문자 등으로 전달합니다.
  - 보안을 위해 초대 링크는 **24시간의 유효 기간**을 가집니다.

- **초대 수락 (Acceptance):**
  - 초대 링크를 클릭하면 앱(또는 웹)으로 이동합니다.
  - 로그인 상태가 아니라면 로그인을 유도합니다.
  - **"'{팔레트명}' 팔레트에 참여하시겠습니까?"** 팝업이 노출됩니다.
  - `[참여하기]` 버튼을 클릭하면 `accept_invitation` RPC 함수가 호출되어 멤버로 등록되고, 즉시 해당 팔레트로 전환됩니다.

- **멤버 관리 (Member Management):**
  - **위치:** 팔레트 설정 모달 내 '멤버 관리' 탭
  - **기능:**
    - **멤버 목록 조회:** 현재 팔레트에 참여 중인 모든 멤버의 프로필(이미지, 이름)과 역할을 리스트 형태로 확인합니다.
    - **역할 표시:** 각 멤버의 역할(Owner, Admin, Editor, Viewer)을 표시합니다.
    - **본인 식별:** 로그인한 사용자 본인에게는 '나' 배지를 표시하여 구분을 돕습니다.
    - **(예정) 권한 관리:** 소유자(Owner)는 멤버의 역할을 변경하거나 추방할 수 있습니다.

##### 3. 권한 관리 시스템 (Roles & Permissions)

소유자가 멤버의 역할(Role)을 지정하여 팔레트 내에서의 권한을 체계적으로 관리합니다. 초대 시 기본 역할은 '작성자(Editor)'로 부여되며, 소유자는 언제든지 역할을 변경할 수 있습니다.

| 역할 (Role)         | 권한 범위      | 주요 기능                                                   | 추천 대상                         |
| :------------------ | :------------- | :---------------------------------------------------------- | :-------------------------------- |
| **Owner (소유자)**  | 모든 권한      | 팔레트 삭제, 멤버 추방, 역할 변경, 카테고리 관리, 내역 관리 | 팔레트를 최초 생성한 사용자       |
| **Admin (관리자)**  | 운영 권한      | 카테고리 추가/수정/삭제, 내역 관리, 새 멤버 초대            | 배우자, 프로젝트 공동 관리자      |
| **Editor (작성자)** | 쓰기/수정 권한 | 내역 추가/수정/삭제 (자신이 쓴 내역 또는 모든 내역)         | 자녀, 팀원 등 일반적인 멤버       |
| **Viewer (뷰어)**   | 읽기 전용      | 모든 내역과 통계 조회만 가능                                | 재정 상황을 공유만 받아야 할 대상 |

##### 4. 알림 시스템 (Notifications)

- **기술:** Firebase Cloud Messaging (FCM)과 Supabase Edge Functions를 연동하여 구현합니다.
- **비용:** FCM 발송 및 Supabase Edge Function의 무료 제공량 내에서 운영되므로, 초기 비용은 발생하지 않습니다.
- **알림 시나리오:**
  - 다른 멤버가 내역을 추가/수정했을 때
  - 새로운 멤버가 팔레트에 참여했을 때
- **PWA 제약사항:** iOS 사용자는 홈 화면에 앱을 추가해야만 푸시 알림을 수신할 수 있습니다. 이를 유도하는 안내 UI가 필요합니다. (예: 최초 팔레트 참여 시 팝업 안내)

---

### 💡 기획자 추가 제안: "시크릿 메모 (Private Memo)" 기능

공유 가계부 사용 시 프라이버시를 보호하면서도, 데이터의 정확성을 유지하기 위한 기능입니다.

- **컨셉:** "공유 가계부에는 심플하게, 나에게는 디테일하게."
- **작동 방식:**
  1.  사용자는 내역 입력 시 **공유될 내용**(예: '기타 지출', '식비')을 일반 입력란에 작성합니다.
  2.  별도로 제공되는 **`🔒 나만 보기 메모`** 입력란에 구체적인 내용(예: '아내 생일 선물', '비상금 인출')을 적습니다.
- **표시 방식:**
  - **다른 멤버에게:** 일반 입력란에 적은 내용('기타 지출')만 보입니다. 시크릿 메모의 존재 자체를 알 수 없습니다.
  - **작성자 본인에게:** 일반 내용 옆에 **자물쇠 아이콘(🔒)**과 함께 시크릿 메모('아내 생일 선물')가 추가로 표시되어, 정확한 지출 내역을 기억할 수 있습니다.

---

## 3. 인터랙션 정책 (Interaction Policy)

- **페이지 이동 (Page Navigation):** 완전히 다른 맥락의 기능으로 전환될 때 사용합니다.
- **모달 (Modal):** 현재 페이지의 맥락을 유지한 채, 특정 과업(Task)을 수행해야 할 때 사용합니다.
- **팝업 (Popup) / 드롭다운 (Dropdown) / 하단 시트 (Bottom Sheet):** 특정 컴포넌트와 관련하여 간단한 선택지나 추가 정보를 제공할 때 사용합니다.

---

## 4. 아이콘 정책

- **라이브러리**: `lucide-react`를 기본 아이콘 라이브러리로 사용합니다.
- **일관성**: 앱 전체에서 아이콘의 스타일이 일관되도록 `lucide-react` 내의 아이콘을 우선적으로 사용합니다.
- **커스텀 아이콘**: 필요한 아이콘이 라이브러리에 없을 경우에만 SVG 파일을 직접 프로젝트에 추가하여 사용합니다.
